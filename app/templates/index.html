<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StoreScout - Instant Shopify Competitor Intelligence</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root{
      --bg: #0b1220;
      --bg-secondary: rgba(255,255,255,0.03);
      --bg-tertiary: rgba(255,255,255,0.05);

      --card: rgba(255,255,255,0.06);
      --card2: rgba(255,255,255,0.04);

      --border: rgba(255,255,255,0.12);
      --border2: rgba(255,255,255,0.10);

      --text: #e5e7eb;
      --muted: rgba(229,231,235,0.72);
      --muted2: rgba(229,231,235,0.60);

      --primary: #3b82f6;
      --primary-dark: #2563eb;

      --success: #22c55e;
      --error: #ef4444;

      --shadow: 0 24px 70px rgba(0,0,0,0.60);
      --radius: 16px;
    }

    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 0%, rgba(59,130,246,0.18), transparent 55%),
                  radial-gradient(1200px 800px at 80% 0%, rgba(34,197,94,0.12), transparent 55%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    .wrap, .container{
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 18px;
    }

    header{
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(10px);
      background: rgba(11,18,32,0.65);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-text {
      font-size: 2rem;
      font-weight: bold;
      letter-spacing: -0.025em;
      color: var(--text);
    }
    .logo-text .store { color: #2463EB; }
    .logo-text .scout { color: #1E40AF; }

    .logo-container {
      display: flex;
      flex-direction: row;
      align-items: center;
    }

    /* Hero */
    .hero {
      padding: 80px 0 60px;
      text-align: center;
    }

    h1{
      font-size: 48px;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #ffffff, rgba(229,231,235,0.70));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 20px;
      color: rgba(229,231,235,0.68);
      margin-bottom: 48px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Generator Card */
    .generator-card{
      max-width: 640px;
      margin: 0 auto 80px;
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 32px;
      box-shadow: var(--shadow);
      text-align: left;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--text);
    }

    input{
      width: 100%;
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border2);
      color: var(--text);
      border-radius: 12px;
      padding: 12px 12px;
      outline: none;
      font-size: 16px;
      font-family: inherit;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    input::placeholder{ color: rgba(229,231,235,0.45); }
    input:focus{
      border-color: rgba(59,130,246,0.55);
      box-shadow: 0 0 0 4px rgba(59,130,246,0.15);
    }

    .hint {
      font-size: 13px;
      color: rgba(229,231,235,0.68);
      margin-top: 8px;
    }

    .button-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 14px;
    }

    button{
      flex: 1;
      appearance: none;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.07);
      color: var(--text);
      border-radius: 12px;
      padding: 12px 14px;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: transform 0.05s ease, background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
    }
    button:hover:not(:disabled){
      background: rgba(255,255,255,0.10);
      border-color: rgba(255,255,255,0.20);
    }
    button:active{ transform: translateY(1px); }
    button:disabled{ opacity: 0.55; cursor: not-allowed; }

    .btn-primary{
      background: linear-gradient(180deg, rgba(59,130,246,0.95), rgba(37,99,235,0.95));
      border-color: rgba(59,130,246,0.35);
    }
    .btn-primary:hover:not(:disabled){
      background: linear-gradient(180deg, rgba(59,130,246,1), rgba(37,99,235,1));
      border-color: rgba(59,130,246,0.55);
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.22);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      display: none;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Status */
    .status{
      margin-top: 14px;
      font-size: 13px;
      color: var(--muted2);
      display: none;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.04);
    }
    .status.show{ display: block; }
    .status.info{ border-color: rgba(59,130,246,0.35); background: rgba(59,130,246,0.08); color: rgba(191,219,254,0.95); }
    .status.success{ border-color: rgba(34,197,94,0.35); background: rgba(34,197,94,0.08); color: rgba(134,239,172,0.95); }
    .status.error{ border-color: rgba(239,68,68,0.35); background: rgba(239,68,68,0.08); color: rgba(254,202,202,0.95); }

    /* URL Help (dark theme) */
    .url-help{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:10px;
      padding:10px 12px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.04);
      border-radius: 12px;
      font-size: 13px;
      color: var(--muted);
    }
    .url-help .dot{
      width:10px;height:10px;border-radius:999px;
      background: rgba(255,255,255,0.35);
      flex:0 0 10px;
    }
    .url-help.ok{
      border-color: rgba(34,197,94,0.35);
      background: rgba(34,197,94,0.08);
      color: rgba(134,239,172,0.95);
    }
    .url-help.ok .dot{ background: rgba(34,197,94,0.95); }
    .url-help.bad{
      border-color: rgba(239,68,68,0.35);
      background: rgba(239,68,68,0.08);
      color: rgba(254,202,202,0.95);
    }
    .url-help.bad .dot{ background: rgba(239,68,68,0.95); }
    .url-help.wait{
      border-color: rgba(59,130,246,0.35);
      background: rgba(59,130,246,0.08);
      color: rgba(191,219,254,0.95);
    }
    .url-help.wait .dot{ background: rgba(59,130,246,0.95); }

    /* Features / How it works / Footer */
    .features { background: var(--bg-secondary); padding: 80px 0; }
    .features h2 { text-align: center; font-size: 32px; margin-bottom: 16px; }
    .features-subtitle { text-align: center; color: rgba(229,231,235,0.68); margin-bottom: 48px; font-size: 18px; }
    .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 32px; }
    .feature-card{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--border);
      padding: 24px;
      border-radius: 12px;
    }
    .feature-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, rgba(239,246,255,0.12), rgba(219,234,254,0.08));
      border: 1px solid rgba(59,130,246,0.25);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      font-size: 24px;
    }
    .feature-card h3 { font-size: 18px; margin-bottom: 8px; }
    .feature-card p { color: rgba(229,231,235,0.68); font-size: 14px; line-height: 1.6; }

    .how-it-works { padding: 80px 0; }
    .how-it-works h2 { text-align: center; font-size: 32px; margin-bottom: 48px; }
    .steps { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 32px; max-width: 900px; margin: 0 auto; }
    .step { text-align: center; }
    .step-number {
      width: 48px; height: 48px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 20px;
      margin: 0 auto 16px;
    }
    .step h3 { font-size: 18px; margin-bottom: 8px; }
    .step p { color: rgba(229,231,235,0.68); font-size: 14px; }

    footer {
      border-top: 1px solid var(--border);
      padding: 32px 0;
      text-align: center;
      color: rgba(229,231,235,0.68);
      font-size: 14px;
    }

    @media (max-width: 768px) {
      h1 { font-size: 36px; }
      .subtitle { font-size: 18px; }
      .hero { padding: 48px 0 40px; }
      .generator-card { padding: 24px; }
      .features, .how-it-works { padding: 48px 0; }
    }
  </style>
</head>

<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <div class="logo-container">
            <svg width="56" height="56" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M30 35 L30 80 C30 85 32 88 37 88 L63 88 C68 88 70 85 70 80 L70 35" stroke="#2463EB" stroke-width="4" stroke-linecap="round" fill="none"/>
              <path d="M25 35 L75 35 L72 42 L28 42 Z" fill="#2463EB"/>
              <path d="M38 35 L38 28 C38 22 42 18 50 18 C58 18 62 22 62 28 L62 35" stroke="#2463EB" stroke-width="4" stroke-linecap="round" fill="none"/>
              <circle cx="65" cy="55" r="18" fill="#1E40AF" opacity="0.9"/>
              <circle cx="65" cy="55" r="12" fill="white" opacity="0.3"/>
              <path d="M78 68 L88 78" stroke="#1E40AF" stroke-width="5" stroke-linecap="round"/>
              <circle cx="65" cy="55" r="6" stroke="#3B82F6" stroke-width="3" fill="none"/>
              <line x1="65" y1="50" x2="65" y2="53" stroke="#3B82F6" stroke-width="3" stroke-linecap="round"/>
              <line x1="65" y1="57" x2="65" y2="60" stroke="#3B82F6" stroke-width="3" stroke-linecap="round"/>
              <line x1="60" y1="55" x2="63" y2="55" stroke="#3B82F6" stroke-width="3" stroke-linecap="round"/>
              <line x1="67" y1="55" x2="70" y2="55" stroke="#3B82F6" stroke-width="3" stroke-linecap="round"/>
            </svg>
            <div class="logo-text">
              <span class="store">Store</span><span class="scout">Scout</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <h1>Instant Shopify Competitor Intelligence</h1>
        <p class="subtitle">Uncover pricing strategies, product catalogs, and discount tactics from any public Shopify store in seconds.</p>

        <div class="generator-card">
          <form id="genForm" novalidate>
            <div class="input-group">
              <label for="storeUrl">Enter Shopify Store URL</label>
              <input
                id="storeUrl"
                name="store_url"
                type="url"
                placeholder="https://example-store.com"
                autocomplete="off"
                required
              />

              <div id="urlHelp" class="url-help">
                <span class="dot"></span>
                <span id="urlMsg">Paste a Shopify store link to check if itâ€™s supported.</span>
              </div>

              <p class="hint">ðŸ’¡ Try: allbirds.com, gymshark.com, or colourpop.com</p>
            </div>

            <div class="button-row">
              <button id="submitBtn" type="submit" class="btn-primary" disabled>
                Continue to Checkout
              </button>
              <div id="spinner" class="spinner"></div>
            </div>

            <div id="status" class="status"></div>
          </form>
        </div>
      </div>
    </section>

    <section class="features">
      <div class="container">
        <h2>What You'll Discover</h2>
        <p class="features-subtitle">Comprehensive insights from public Shopify data</p>

        <div class="feature-grid">
          <div class="feature-card">
            <div class="feature-icon">ðŸ“Š</div>
            <h3>Pricing Architecture</h3>
            <p>Complete price distribution, median positioning, and competitive price bands to inform your strategy.</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ðŸŽ¯</div>
            <h3>Discount Strategy</h3>
            <p>Promotional intensity, discount depth, and seasonal pricing patterns across their catalog.</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ðŸš€</div>
            <h3>Launch Velocity</h3>
            <p>New product cadence to understand their expansion pace.</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ðŸ“¦</div>
            <h3>Catalog Intelligence</h3>
            <p>Product counts, stock levels, variant complexity, and inventory health metrics.</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ðŸŽª</div>
            <h3>Market Positioning</h3>
            <p>Budget, mid-market, or premium positioning based on pricing and product mix.</p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ðŸ’Ž</div>
            <h3>Top Lists</h3>
            <p>Most expensive products, biggest discounts, newest additions, and recent updates.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="how-it-works">
      <div class="container">
        <h2>How It Works</h2>

        <div class="steps">
          <div class="step">
            <div class="step-number">1</div>
            <h3>Enter URL</h3>
            <p>Paste any Shopify store URL into the form above</p>
          </div>
          <div class="step">
            <div class="step-number">2</div>
            <h3>We Verify</h3>
            <p>We make sure we can access the storeâ€™s public product catalog</p>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <h3>Checkout â†’ PDF</h3>
            <p>Pay once, then your report downloads</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2026 StoreScout. Public catalog data only. No checkout or traffic analytics.</p>
    </div>
  </footer>

  <script>
    const form = document.getElementById('genForm');
    const storeUrl = document.getElementById('storeUrl');
    const btn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');

    const urlHelp = document.getElementById('urlHelp');
    const urlMsg = document.getElementById('urlMsg');

    const statusEl = document.getElementById('status');

    let checkTimer = null;
    let lastChecked = "";
    let lastOkBase = null;
    let isChecking = false;

    function setHelp(state, msg){
      urlHelp.classList.remove('ok','bad','wait');
      if(state) urlHelp.classList.add(state);
      urlMsg.textContent = msg;
    }

    function setStatus(msg, type){
      statusEl.textContent = msg || "";
      statusEl.className = "status" + (msg ? (" show " + (type || "")) : "");
    }

    function normalizeUrl(raw){
      raw = (raw || "").trim();
      if(!raw) return null;

      // Add scheme if missing
      if(!raw.includes("://")) raw = "https://" + raw;

      try{
        const u = new URL(raw);
        if(!u.hostname) return null;
        if(u.protocol !== "http:" && u.protocol !== "https:") return null;

        // Base only (supports https://www.brand.com/ etc.)
        return u.protocol + "//" + u.host;
      }catch(e){
        return null;
      }
    }

    function humanizeCheck(res, data){
      // Supported
      if(res.ok && data && data.ok){
        return {
          state: "ok",
          msg: "Store supported â€” you can continue to checkout."
        };
      }

      const status = res.status;
      const reason = (data && (data.reason || data.detail)) ? String(data.reason || data.detail) : "";

      // Common â€œblockedâ€ cases
      if(status === 403){
        return {
          state: "bad",
          msg: "This store blocks public catalog access (bot protection), so we canâ€™t analyze it. Try another store."
        };
      }

      // Common â€œnot found / hiddenâ€ cases
      if(status === 404){
        return {
          state: "bad",
          msg: "We couldnâ€™t access this storeâ€™s public product catalog. It may be hidden or not a supported Shopify store."
        };
      }

      // Rate limited
      if(status === 429){
        return {
          state: "bad",
          msg: "This store is rate-limiting requests right now. Please try again in a minute."
        };
      }

      // Network-ish
      if(reason.toLowerCase().includes("network")){
        return {
          state: "bad",
          msg: "We couldnâ€™t reach this store right now. Double-check the link and try again."
        };
      }

      // Non-JSON / â€œnot Shopifyâ€ vibes
      if(reason.toLowerCase().includes("did not return json") || reason.toLowerCase().includes("not shopify")){
        return {
          state: "bad",
          msg: "This store doesnâ€™t look like a supported Shopify store (or itâ€™s blocking access). Try a different store."
        };
      }

      // Fallback
      return {
        state: "bad",
        msg: "We canâ€™t analyze this store right now. Try another Shopify store."
      };
    }

    async function checkStoreNow(){
      const raw = (storeUrl.value || "").trim();
      const base = normalizeUrl(raw);

      lastOkBase = null;

      if(!base){
        btn.disabled = true;
        setHelp("bad", "Enter a valid store link (example: brand.com).");
        return;
      }

      if(isChecking) return;
      isChecking = true;
      btn.disabled = true;
      setHelp("wait", "Checking this storeâ€¦");
      setStatus("", "");

      try{
        const res = await fetch(`/check_store?store_url=${encodeURIComponent(base)}`);
        const data = await res.json().catch(()=> ({}));

        const ui = humanizeCheck(res, data);
        setHelp(ui.state, ui.msg);

        if(res.ok && data && data.ok){
          lastOkBase = data.base_url || base;
          lastChecked = base;
          btn.disabled = false;
        }else{
          lastChecked = base;
          btn.disabled = true;
        }

      }catch(err){
        console.error(err);
        setHelp("bad", "We couldnâ€™t reach this store right now. Please try again.");
        btn.disabled = true;
      }finally{
        isChecking = false;
      }
    }

    function scheduleCheck(){
      const raw = (storeUrl.value || "").trim();
      const base = normalizeUrl(raw);

      if(!base){
        lastChecked = "";
        lastOkBase = null;
        btn.disabled = true;
        setHelp(null, "Paste a Shopify store link to check if itâ€™s supported.");
        return;
      }

      // If unchanged and already OK
      if(base === lastChecked && lastOkBase){
        btn.disabled = false;
        setHelp("ok", "âœ… Store supported â€” you can continue to checkout.");
        return;
      }

      // Debounce
      if(checkTimer) clearTimeout(checkTimer);
      checkTimer = setTimeout(checkStoreNow, 650);
    }

    // Only check on input/paste (no blur = no â€œdouble check then click twiceâ€)
    storeUrl.addEventListener("input", scheduleCheck);
    storeUrl.addEventListener("paste", () => setTimeout(scheduleCheck, 0));

    // Initial state
    btn.disabled = true;
    setHelp(null, "Paste a Shopify store link to check if itâ€™s supported.");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const raw = (storeUrl.value || "").trim();
      const base = normalizeUrl(raw);

      if(!base){
        btn.disabled = true;
        setHelp("bad", "Please enter a valid store link before continuing.");
        return;
      }

      // If not validated yet, validate once here
      if(!lastOkBase || lastChecked !== base){
        await checkStoreNow();
        if(!lastOkBase) return;
      }

      try{
        btn.disabled = true;
        spinner.style.display = "inline-block";
        setStatus("Starting checkoutâ€¦", "info");

        const fd = new FormData();
        fd.append("store_url", lastOkBase);

        const res = await fetch("/buy", { method: "POST", body: fd });

        if(!res.ok){
          let detail = "Could not start checkout.";
          try{
            const j = await res.json();
            if(j && (j.detail || j.error)) detail = j.detail || j.error;
          }catch(_){}
          setStatus(detail, "error");
          btn.disabled = false;
          return;
        }

        const j = await res.json().catch(()=> ({}));
        if(j && j.url){
          window.location.href = j.url;
          return;
        }

        setStatus("Checkout didnâ€™t return a redirect link.", "error");
        btn.disabled = false;

      }catch(err){
        console.error(err);
        setStatus("Network error starting checkout. Please try again.", "error");
        btn.disabled = false;
      }finally{
        spinner.style.display = "none";
      }
    });
  </script>
</body>
</html>
